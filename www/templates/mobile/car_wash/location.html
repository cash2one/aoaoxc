{% extends "mobile/car_wash/base_car_wash.html" %}

{% block title_all %}嗷嗷洗车{% endblock %}

{% block css %}
<style type="text/css">

</style>
{% endblock %}

{% block javascript %}
<script type="text/javascript" src="http://api.map.baidu.com/api?type=quick&ak=o4O12xsCGirt60xLVt1GLTI6&v=1.0"></script>
<script type="text/javascript"> 
$(document).ready(function(){
	$('#map').height($(window).height() - 40); 

	// var address=window.location.search.split('=')[1];
	// $.QXMap.locationByName(decodeURI(address), new BMap.Map("map"));

	var longitude = $.Global.Utils.getQueryString('longitude'),
		latitude = $.Global.Utils.getQueryString('latitude'),
		name = decodeURI($.Global.Utils.getQueryString('name')),
		map = new BMap.Map("map"),
		targetPoint = new BMap.Point(longitude, latitude),
		marker = new BMap.Marker(targetPoint); // 创建标注

	map.centerAndZoom(targetPoint, 15);
	map.addControl(new BMap.ZoomControl());
	// 将标注添加到地图中
	map.addOverlay(marker); 

	navigator.geolocation.getCurrentPosition(function(position){
		
		// 百度地图API功能
		var myPoint = new BMap.Point(position.coords.longitude, position.coords.latitude),

			opts = {
				width : 250,    // 信息窗口宽度
				height: 70,     // 信息窗口高度
				title : name  // 信息窗口标题
			},
			infoWindow = new BMap.InfoWindow("点击红色标记开始导航", opts);  // 创建信息窗口对象
		map.openInfoWindow(infoWindow, targetPoint); //开启信息窗口
		
		// 标注点击事件
		marker.addEventListener("click", function(){
			/*start|end：（必选）
			{name:string,latlng:Lnglat}
			opts:
			mode：导航模式，固定为
			BMAP_MODE_TRANSIT、BMAP_MODE_DRIVING、
			BMAP_MODE_WALKING、BMAP_MODE_NAVIGATION
			分别表示公交、驾车、步行和导航，（必选）
			region：城市名或县名  当给定region时，认为起点和终点都在同一城市，除非单独给定起点或终点的城市
			origin_region/destination_region：同上
			*/
			var start = {
					 name: "我的位置",
					 latlng: myPoint
				},
				end = {
					name: name,
					latlng: targetPoint
				},
				opts = {
					mode: BMAP_MODE_DRIVING,
					region: "成都"
				},
				routeSearch = new BMap.RouteSearch();

			routeSearch.routeCall(start, end, opts);
		});
	});
	
});
</script>
{% endblock %}

{% block bar_title %}地图{% endblock %}

{% block container %}
<div id="map" class="mt-40 col-xs-12 pr-0 pl-0"></div>
{% endblock %}

{% block nav %}{% endblock %}