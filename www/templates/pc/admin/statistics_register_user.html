{% extends "pc/base/base_admin.html" %}
{% load custom_tags %}
{% load custom_filters %}
{% block title %}注册用户统计{% endblock %}

{% block base_css %}
<link rel="stylesheet" type="text/css" href="{{MEDIA_URL}}css/animate/animate.min.css" />
<style type="text/css">
body{
    background-color: #f2f3f8;
    overflow: hidden;
}

.bgc-e66a5d{
    background-color: #e66a5d;
}

.bdr-1{
    border-right: solid 1px #2D2D2D;
}

.bdl-1{
    border-left: solid 1px #2D2D2D;
}

.card{
    transition: all 0.5s;
    cursor: pointer;
}

.card.active{
    background-color: #e66a5d;
}

.card:hover{
    background-color: #e66a5d;
}
</style>
{% endblock %}

{% block base_js %}
<script type="text/javascript" src="{{MEDIA_URL}}js/jquery/countUp.js"></script>
<script type="text/javascript" src="{{MEDIA_URL}}js/jquery/jquery.easing.1.3.min.js"></script>
<script type="text/javascript" src="{{MEDIA_URL}}js/echarts/echarts.js"></script>
<script type="text/javascript">

require.config({
    paths: {
        echarts: '{{MEDIA_URL}}js/echarts'
    }
});

require(
    [
        "echarts", 
        "echarts/chart/line", 
        "echarts/chart/bar"
    ],
    function(ec){
        echarts = ec;
        
        registerCountChart();
        todayRegisterCountChart();
        todayOrderCountChart();
        todayBalanceChart();
    }
);

var echarts,
    registerCountChart = function(){
        var main = echarts.init(document.getElementById('register-count-chart'));

        main.setOption({
            title: {
                text: '注册总用户数'
            },
            tooltip: {
                trigger: 'axis',
                axisPointer: {
                    type: 'line',
                    lineStyle: {
                      color: '#ddd',
                      width: 1,
                      type: 'solid'
                    }
                },
                formatter: '{b}<br />{a}: {c} '
            },
            legend: {
                data:['用户数']
            },
            toolbox: {
                show: false
            },
            calculable: false,
            xAxis: [{
                type: 'category',
                boundaryGap: false,
                data: [
                    '01-01', '01-02', '01-03', '01-04', '01-05',
                    '01-06', '01-07', '01-08', '01-09', '01-10',
                    '01-11', '01-12', '01-13', '01-14', '01-15',
                    '01-16', '01-17', '01-18', '01-19', '01-20',
                    '01-21', '01-22', '01-23', '01-24', '01-25',
                    '01-26', '01-27', '01-28', '01-29', '01-30'
                ],
                splitLine: {
                    show: true,
                    lineStyle: {
                        color: ['#e2e2e2'],
                        width: 1,
                        type: 'solid'
                    }
                },
                axisLine: {
                    show: true,
                    lineStyle: {
                        color: '#888',
                        width: 2,
                        type: 'solid'
                    }
                }
            }],
            yAxis: [{
                type : 'value',
                splitLine: {
                    show: true,
                    lineStyle: {
                        color: ['#e2e2e2'],
                        width: 1,
                        type: 'solid'
                    }
                },
                axisLine: {
                    show: true,
                    lineStyle: {
                        color: '#888',
                        width: 2,
                        type: 'solid'
                    }
                }
            }],
            color: ['#e66a5d'],
            series : [{
                name:'用户数',
                type:'line',
                smooth: true,
                itemStyle: {
                    normal: {
                        areaStyle: {
                            type: 'default'
                        }
                    }
                },
                data: [
                    '122', '135', '148', '151', '169',
                    '188', '201', '249', '253', '287',
                    '365', '399', '421', '466', '574',
                    '425', '682', '324', '151', '169',
                    '457', '201', '125', '774', '569',
                    '224', '423', '220', '124', '856'
                ]
            }]
        });
    },

    todayRegisterCountChart = function(){
        var main = echarts.init(document.getElementById('today-register-count-chart'));
        
        main.setOption({
            title: {
                text: '今日注册用户数'
            },
            tooltip : {
                trigger: 'axis',
                axisPointer: {
                    type: 'line',
                    lineStyle : {
                      color: '#ddd',
                      width: 1,
                      type: 'solid'
                    }
                },
                formatter: '{b}<br />{a}: {c} '
            },
            legend: {
                data:['用户数']
            },
            toolbox: {
                show : false
            },
            calculable : false,
            xAxis : [{
                type: 'category',
                boundaryGap: false,
                data: [
                    '01-01', '01-02', '01-03', '01-04', '01-05',
                    '01-06', '01-07', '01-08', '01-09', '01-10',
                    '01-11', '01-12', '01-13', '01-14', '01-15'
                ],
                splitLine: {
                    show: true,
                    lineStyle: {
                        color: ['#e2e2e2'],
                        width: 1,
                        type: 'solid'
                    }
                },
                axisLine: {
                    show: true,
                    lineStyle: {
                        color: '#888',
                        width: 2,
                        type: 'solid'
                    }
                }
            }],
            yAxis: [{
                type : 'value',
                splitLine: {
                    show: true,
                    lineStyle: {
                        color: ['#e2e2e2'],
                        width: 1,
                        type: 'solid'
                    }
                },
                axisLine: {
                    show: true,
                    lineStyle: {
                        color: '#888',
                        width: 2,
                        type: 'solid'
                    }
                }
            }],
            color: ['#e66a5d'],
            series: [{
                name: '用户数',
                type: 'line',
                smooth: true,
                itemStyle: {
                    normal: {
                        areaStyle: {
                            type: 'default'
                        }
                    }
                },
                data: [
                    '25', '14', '19', '32', '22',
                    '23', '12', '8', '21', '16',
                    '13', '32', '49', '22', '17'
                ]
            }]
        });
    },

    todayOrderCountChart = function(){
        var main = echarts.init(document.getElementById('today-order-count-chart'));
        
        main.setOption({
            title: {
                text: '今日订单数'
            },
            tooltip : {
                trigger: 'axis',
                axisPointer: {
                    type: 'line',
                    lineStyle : {
                      color: '#ddd',
                      width: 1,
                      type: 'solid'
                    }
                },
                formatter: '今日 {b} 点<br />{a}: {c} '
            },
            legend: {
                data:['订单数']
            },
            toolbox: {
                show : false
            },
            calculable : false,
            xAxis : [{
                type: 'category',
                boundaryGap: true,
                data: [
                    '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',
                    '10', '11', '12', '13', '14', '15', '16', '17', '18',
                    '19', '20', '21', '22', '23'
                ],
                axisLine: {
                    show: true,
                    lineStyle: {
                        color: '#888',
                        width: 2,
                        type: 'solid'
                    }
                },
                splitLine: {
                    show: false,
                    lineStyle: {
                        color: ['#e2e2e2'],
                        width: 1,
                        type: 'solid'
                    }
                }
            }],
            yAxis : [{
                type : 'value',
                axisLine: {
                    show: true,
                    lineStyle: {
                        color: '#888',
                        width: 2,
                        type: 'solid'
                    }
                },
                splitLine: {
                    show: true,
                    lineStyle: {
                        color: ['#e2e2e2'],
                        width: 1,
                        type: 'solid'
                    }
                }
            }],
            color: ['#e66a5d'],
            series : [{
                name: '订单数',
                type: 'bar',
                data: [
                    '12', '8', '10', '3', '2',
                    '18', '35', '38', '39', '55',
                    '98', '100', '121', '85', '79',
                    '88', '102', '130', '80', '40',
                    '42', '30', '28', '10'
                ]
            }]
        });
    },

    todayBalanceChart = function(){
        var main = echarts.init(document.getElementById('today-balance-chart'));
        
        main.setOption({
            title: {
                text: '今日订单金额'
            },
            tooltip : {
                trigger: 'axis',
                axisPointer: {
                    type: 'line',
                    lineStyle : {
                      color: '#ddd',
                      width: 1,
                      type: 'solid'
                    }
                },
                formatter: '今日 {b} 点<br />{a}: {c} '
            },
            legend: {
                data:['订单金额(元)']
            },
            toolbox: {
                show : false
            },
            calculable : false,
            xAxis : [{
                type: 'category',
                boundaryGap: true,
                data: [
                    '0', '1', '2', '3', '4', '5', '6', '7', '8', '9',
                    '10', '11', '12', '13', '14', '15', '16', '17', '18',
                    '19', '20', '21', '22', '23'
                ],
                axisLine: {
                    show: true,
                    lineStyle: {
                        color: '#888',
                        width: 2,
                        type: 'solid'
                    }
                },
                splitLine: {
                    show: false,
                    lineStyle: {
                        color: ['#e2e2e2'],
                        width: 1,
                        type: 'solid'
                    }
                }
            }],
            yAxis : [{
                type : 'value',
                axisLine: {
                    show: true,
                    lineStyle: {
                        color: '#888',
                        width: 2,
                        type: 'solid'
                    }
                },
                splitLine: {
                    show: true,
                    lineStyle: {
                        color: ['#e2e2e2'],
                        width: 1,
                        type: 'solid'
                    }
                }
            }],
            color: ['#e66a5d'],
            series : [{
                name: '订单金额(元)',
                type: 'bar',
                data: [
                    '12', '8', '10', '3', '2',
                    '18', '35', '38', '39', '55',
                    '98', '100', '121', '85', '79',
                    '88', '102', '130', '80', '40',
                    '42', '30', '28', '10'
                ]
            }]
        });
    };

$(document).ready(function(){
    
    var sheepVoice = $('#sheep-voice')[0],
        moneyVoice = $('#money-voice')[0],
        registerCount = new countUp("register-count"),
        todayRegisterCount = new countUp("today-register-count", 0, 32).start(),
        todayOrderCount = new countUp("today-order-count", 0, 68).start(),
        todayBalance = new countUp("today-balance", 0, 885.42, 2).start(),
        // 自动切换图表
        autoChangeCard = function(){
            var index = 0, cards = $('.card');

            $.each(cards, function(i){
                if(cards.eq(i).hasClass('active')){
                    index = (cards.length <= (i+1)) ? 0 : (i+1);
                }
            });

            cards.eq(index).click();
        };

    var c = 1024;
    
    registerCount.startVal = 0;
    registerCount.endVal = c;
    registerCount.start();
    window.setInterval(function(){

        registerCount.reset();
        registerCount.startVal = c;
        c += Math.round(Math.random() * 30 + 3);
        registerCount.endVal = c;
        registerCount.start();
        
        // 播放声音
        sheepVoice.src = sheepVoice.src;
        // sheepVoice.play();

    }, 5000);

    // 点击卡片
    $('.card').bind('click', function(){
        $('.card').removeClass('active');
        $(this).addClass('active');

        // 将当前显示的图表移除
        var visibleChart = $('.charts>div').filter(function(i){return $(this).css('opacity') != "0"});
        visibleChart.removeClass("rollIn").addClass("rollOut");
        // 动画完毕之后设置透明度为0
        visibleChart.one('webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend', function(){
            visibleChart.css({'opacity': 0, 'z-index': 99}).removeClass("rollOut");
        });

        // 将对应的图表显示出来
        $('#' + $(this).data('chart')).css({'opacity': 1, 'z-index': 100}).addClass("rollIn");
    });

    // 每隔13秒自动切换图表
    window.setInterval(autoChangeCard, 13000);
});

</script>
{% endblock %}
{% block header %}{% endblock %}

{% block container %}
<audio src="{{MEDIA_URL}}media/money.wav" id="money-voice"></audio>
<audio src="{{MEDIA_URL}}media/sheep.wav" id="sheep-voice"></audio>

<div class="pt-45">
    <div class="row pr charts">
        <div id="register-count-chart" class="pa col-md-12 min-h400 animated z100" style="left:0; top:0; "></div>
        <div id="today-register-count-chart" class="pa col-md-12 min-h400 animated" style="left:0; top:0; opacity: 0"></div>
        <div id="today-order-count-chart" class="pa col-md-12 min-h400 animated" style="left:0; top:0; opacity: 0"></div>
        <div id="today-balance-chart" class="pa col-md-12 min-h400 animated" style="left:0; top:0; opacity: 0"></div>
    </div>
</div>
{% endblock container %}


{% block footer %}
<div class="pa w h200" style="left:0; bottom: 0; background-color: #1d2326;">
    <div class="container">
        <div class="row co5 text-center pl-80">
            <div class="col-md-4 pt-45 h200 bdr-1 card active" data-chart="register-count-chart">
                <div class="f16 pb-5">注册总用户数</div>
                <div class="f60" id="register-count">0</div>
            </div>
            <div class="col-md-2 pt-45 h200 bdr-1 card" data-chart="today-register-count-chart">
                <div class="f16 pb-5">今日注册用户数</div>
                <div class="f60" id="today-register-count">0</div>
            </div>
            <div class="col-md-2 pt-45 h200 bdr-1 card" data-chart="today-order-count-chart">
                <div class="f16 pb-5">今日订单数</div>
                <div class="f60" id="today-order-count">0</div>
            </div>
            <div class="col-md-3 pt-45 h200 card pl-0 pr-0" data-chart="today-balance-chart">
                <div class="f16 pb-5">今日订单金额</div>
                <div>
                    <i class="fa fa-rmb f55"></i>
                    <span class="f60" id="today-balance">0.00</span>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}